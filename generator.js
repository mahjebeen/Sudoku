//predefined grids
//36-40 given
const easy = {
    1: [
        "1-----68-59---2--47-45---19----45-263---268--256-914--427--35-8-15-87-42--32-4---", 
        "132479685598162734764538219871345926349726851256891473427913568915687342683254197"
    ],
    2: [
        "-3---9-8-5-81--734-64--8---87--4--2-34-7-6--12-6---47--2791--68-15--73-26--2-4--7",
        "132479685598162734764538219871345926349726851256891473427913568915687342683254197"
    ],
    3: [
        "9--87-3--85-3--7--47-2-689-5-84--91-34--15--71-7-8-2-46--13--79-3-5------1-76---8",
        "926871345851349726473256891568427913342915687197683254685132479734598162219764538"
    ],
    4: [
        "92--7--4-851-49-2-4-3----91---427-13-4-9-56--19---3-5-6-5-3-47-7--5--1-2-19-6--3-",
        "926871345851349726473256891568427913342915687197683254685132479734598162219764538"
    ],
    5: [
        "----9-5-4-691-7-83---2-4--95--6-2-9-6-4--172--725---6-9-64-58-71--76-9-2-47-28---",
        "281396574469157283735284619513672498694831725872549361926415837158763942347928156"
    ],
    6: [
        "-81-9--744---5-2-373-2---1--13-7-4-8-9-83---58---493-1-2-41--3--5---39---4-9-8-56",
        "281396574469157283735284619513672498694831725872549361926415837158763942347928156"
    ],
    7: [
        "---3-9--5--917-8-2-3-24-19--26-51---15--3-4-9-4--8--61--3-2-9-4--4-1-2-787---46--",
        "281369745469175832735248196926451378158736429347982561513627984694813257872594613"
    ],
    8: [
        "--1---74-4---75-327-5--81-69--45--78--87-6-2-3--9-25-1-1---79---9-813-5--7-59--13",
        "281369745469175832735248196926451378158736429347982561513627984694813257872594613"
    ],
    9: [
        "8-2-9-15--45---39--96--7-8-4-95-176---8---415-6-4-3-2--8---567-6-3-2-54--5---6---",
        "832694157745812396196357284429581763378269415561473928984135672613728549257946831"
    ],
    10: [
        "-3-6-4--77---123--19-35-2--429---7--3--2-9--55---7-9-----135---61--2-5-9--79--831",
        "832694157745812396196357284429581763378269415561473928984135672613728549257946831"
    ],
    
  };
  //31-35 given
  const medium = {
  1: [
    "---15---6-9-2---5--47--6-1-7-2-3--49---67-53-3-65------73-1-9-2-24---1-5-6-92-3--",
    "238157496691284753547396218752831649489672531316549827873415962924763185165928374"
  ],
  2: [
    "238---49-6-1--47----73--2---528---4--8---25---16---8--8---15--2---7--1--1--9---74",
    "238157496691284753547396218752831649489672531316549827873415962924763185165928374"
  ],
  3: [
    "---4-6---3962--5---8--5--19----7--56-1-9--8---6---5-4-6-25--49--31----255--82-3-1",
    "157496283396218574284753619928374156415962837763185942672531498831649725549827361"
  ],
  4: [
    "15-4---83-96----74-8-7--6--92-37--5-41----83--63-8--4-6-2-3-4---3-6----5--98-7---",
    "157496283396218574284753619928374156415962837763185942672531498831649725549827361"
  ],
  5: [
    "----1-6-2-----48-161--72---8--4---577----13-----73--8-3--92-4---291-----5--34----",
    "984513672257694831613872549832469157745281396196735284378926415429158763561347928"
  ],
  6: [
    "9-4--3-----7-94--16--87-----3-4-9-5-7--28---619-----8--7-9--41---9-5--6--61--7--8",
    "984513672257694831613872549832469157745281396196735284378926415429158763561347928"
  ],
  7: [
    "-26314----85----19--78----6-9-4-1-52--32---981---9---75---2-8-4--1-4---32-49-6---",
    "926314785485762319317859246798431652643275198152698437579123864861547923234986571"
  ],
  8: [
    "9-----785--57--319-----9-4-7-84--65---32---9-1-2-984----91------615-----2--98--71",
    "926314785485762319317859246798431652643275198152698437579123864861547923234986571"
  ],
  9: [
    "2-7-8-----9-3246-8863-----5-1-65--97--42---83--8-4---64-981-----819--3--5----7--9",
    "247586931195324678863179245312658497674291583958743126439815762781962354526437819"
  ],
  10: [
    "2------31---3-4--8--3179---31--58----742-1-8-9-87-----43--1--6-----6-35----43----",
    "247586931195324678863179245312658497674291583958743126439815762781962354526437819"
  ],
};
//20-25
  const hard ={
    1: [
    "-1-5---94--97--2----5----7-5---3---7-6-----1---8--5---1-4------2-3-----9-7----8--",
    "712583694639714258845269173521436987367928415498175326184697532253841769976352841"
  ],
  2: [
    "-----3-9--3----2--8-----17-----3-9------28----981---2---46-------3--1----7-----4-",
    "712583694639714258845269173521436987367928415498175326184697532253841769976352841"
  ],
  3: [
    "-59--1--4-1-9------2---7-5---7-----3------8----13---9----5-------8----41-4--1---2",
    "659281734714953286823647159597168423236479815481325697172594368968732541345816972"
  ],
  4: [
    "-----1-3-------2--8---4------7-6---3----7--1-4-----69-1--5---6-9---325-----169---",
    "659281734714953286823647159597168423236479815481325697172594368968732541345816972"
  ],
  5: [
    "8-------9-9-----7----928--13-1-----4-----1--7---5-9-1--46---832--3-8-----2--9----",
    "815763429692415278734928561351672984469831257287549613946157832573284196128396745"
  ],
  6: [
    "8---6-------415------9-8---35------44-9---25-------61---6-------7----1-6---------",
    "815763429692415278734928561351672984469831257287549613946157832573284196128396745"
  ],
  7: [
    "-----2--32--83----6--54---2----9-----3--5------62----53----5-2--2------8---92----",
    "984672513257831694613549872745396281832157569196284735378415926429763158561928347"
  ],
  8: [
    "9-------3-5-8---9----5-9-----5--62----21---691--2-------8-1-----2----1----1------",
    "984672513257831694613549872745396281832157569196284735378415926429763158561928347"
  ],
  9: [
    "2--------1-----78---3-------5---3---3-----97---4-------8----5-3-2----1---39--56--",
    "247586319195324786863179452958743261312658974674291835781962543526437198439815627"
  ],
  10: [
    "------3-9-----4--6---1---52--8-----13-2----7---4-9---57---62----2---7--8----1----",
    "247586319195324786863179452958743261312658974674291835781962543526437198439815627"
  ],
};

var currentAnswer="";
var timer;
var timeRemaining;
var lives;
var selectedNum;
var selectedTile;
var disableSelect;

window.onload = function(){
    const urlParams = new URLSearchParams(window.location.search);
    const difficulty = urlParams.get('difficulty')||easy||medium||hard;
   

    const level = parseInt(urlParams.get('level'), 10) || 1; // Default to level 1

    let board, initialTime;
    
    if (difficulty === "easy" && easy[level]) {
        [board, currentAnswer] = easy[level];
        initialTime = 600; //time for easy difficulty
      }else if ( difficulty === "medium" && medium[level]) {
        [board, currentAnswer] = medium[level];
        initialTime = 300;//time for medium difficulty
       } else if (difficulty === "hard" && hard[level]) {
        [board, currentAnswer] = hard[level];
        initialTime = 180;//time for hard difficulty
       }else {
        console.error("Difficulty level not found or not specified. Defaulting to easy[1].");
        [board, currentAnswer] = easy[1]; // Default to first easy puzzle if not found
        initialTime = 600; // Default time
      }

    lives = 3;
    disableSelect = false;
    id("lives").textContent = "Lives Remaining 3";
    generateBoard(board);
    startTimer(initialTime);

    id("theme1").addEventListener("change", function () {
        // Light theme selected
        document.body.classList.remove("dark");
    });

    id("theme2").addEventListener("change", function () {
        // Dark theme selected
        document.body.classList.add("dark");
    });

    id("number-choose").classList.remove("hidden");

    for(let i = 0; i< id("number-choose").children.length; i++){
        id("number-choose").children[i].addEventListener("click",function(){
         if(!disableSelect){
            if(this.classList.contains("selected")){
                this.classList.remove("selected");
                selectedNum=null;
            }else{
              //remove 'selected' class from all numbers to select only one number at a time
                for(let i=0; i<9; i++){
                    id("number-choose").children[i].classList.remove("selected");
                }
                this.classList.add("selected");
                selectedNum= this;
                updateMove();
            }
         }
        });

    }
}

//timer function
function startTimer(initialTime) {
    timeRemaining = initialTime;
    id("timer").textContent = timeConversion(timeRemaining);

    timer = setInterval(function () {
        timeRemaining--;
        if (timeRemaining <= 0) {
            endGame();
            clearInterval(timer);
        }

        id("timer").textContent = timeConversion(timeRemaining);
    }, 1000);
}

//to show time as 00:00
function timeConversion(time) {
    let minutes = Math.floor(time / 60);
    if (minutes < 10) minutes = "0" + minutes;
    let seconds = time % 60;
    if (seconds < 10) seconds = "0" + seconds;
    return minutes + ":" + seconds;
}

function generateBoard(board){
    clearPrevious();
    let idCount=0;
    for(let i=0; i< 81; i++){
        let tile= document.createElement("p");
        if(board.charAt(i) != "-"){
            tile.textContent = board.charAt(i);
        }else{
            tile.addEventListener("click", function(){
                if(!disableSelect){
                    if(tile.classList.contains("selected")){
                        tile.classList.remove("selected");
                        selectedTile = null;
                    }else{
                        for(let i = 0; i<81; i++){
                          qsa(".tile")[i].classList.remove("selected");
                        }
                        tile.classList.add("selected");
                        selectedTile=tile;
                        updateMove();
                    }
                }
            });
        }
        tile.id = idCount;
        idCount++;
        tile.classList.add("tile");
        //borders to look good visually
        if((tile.id>17 && tile.id<27) ||(tile.id > 44 && tile.id <54)){
            tile.classList.add("bottomBorder");
        }
        if((tile.id+1)%9 == 3 || (tile.id + 1) % 9 == 6){
          tile.classList.add("rightBorder");  
        }
        id("board").appendChild(tile);
    }
}
function updateMove() {
    if(selectedTile && selectedNum) {
        // Place the selected number in the tile
        selectedTile.textContent = selectedNum.textContent;

        // Immediately deselect the number after placing it
        if (selectedNum) {
            selectedNum.classList.remove("selected");
            selectedNum = null;
        }

        // Check if the number matches the correct answer
        if(checkCorrect(selectedTile)) {
            // If correct, deselect the tile and check if the board is complete
            selectedTile.classList.remove("selected");
            selectedTile = null;
           // check if all the tiles are filled 
         if(checkDone()) { 
            endGame();
         }
        } else {
            // If incorrect, flash red, decrement lives, and clear the tile
            selectedTile.classList.add("incorrect");
            setTimeout(function() {
                lives--;
                if(lives <= 0) {
                    endGame(); // Function to handle game over
                } else {
                    id("lives").textContent = "Lives Remaining: " + lives;
                    selectedTile.classList.remove("incorrect", "selected");
                    selectedTile.textContent = "";
                    selectedTile = null;
                    disableSelect = false;
                }
            }, 1000);
        }
    }
}

//to check all the cells are filled 
function checkDone(){
    let tiles= qsa(".tile");
    for (let i=0; i<tiles.length; i++){
        if( tiles[i].textContent === "") return false;
    }
    return true;
}

function endGame() {
    disableSelect = true;
    clearTimeout(timer);

   if (lives === 0 || timeRemaining === 0) {
        animateLostText()
    }  else {
        animateWinText() 
    }
    let playAgainBtn = document.createElement("button");
    playAgainBtn.textContent = "Play Again";
    playAgainBtn.id = "play-again-btn";
    document.getElementById("game").appendChild(playAgainBtn); // Append to the container
    
    playAgainBtn.addEventListener("click", function() {
        window.location.href = "index.html"; 
    });

 
}

function animateWinText() {
    const winSticker = document.createElement("div");
    winSticker.id = "win-sticker";
    winSticker.textContent = "Congratulations!";
    document.body.appendChild(winSticker);
}
function animateLostText() {
    const lostSticker = document.createElement("div");
    lostSticker.id = "lost-sticker";
    lostSticker.textContent = "Better Luck Next Time!";
    document.body.appendChild(lostSticker);
}
 
function checkCorrect(tile) {
    let index = parseInt(tile.id);
    let correct = currentAnswer.charAt(index);
    return tile.textContent == correct;
} 

//clear previous moves 
function clearPrevious(){
    let tiles= qsa(".tile");
    for (let i = 0; i < tiles.length; i++){
      tiles[i].remove();
    }
    if(timer) clearTimeout(timer);
    for (let i = 0; i < id("number-choose").children.length; i++){
      id("number-choose").children[i].classList.remove("selected");
    }
    selectedTile=null;
    selectedNum=null;
    }


   //short functions to make them easy to use 
  function id(id){
    return document.getElementById(id);
  }
 function qs(selector){
    return document.querySelector(selector);
 } 
  function qsa(selector){
    return document.querySelectorAll(selector);
  }    





